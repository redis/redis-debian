name: Build Pull Request

on:
  pull_request:
    branches:
    - master
    - release/*
    - unstable
  push:
    branches:
    - master
    - release/*
    - unstable
  workflow_dispatch:
  workflow_call:

jobs:
  build-n-test:
    uses: ./.github/workflows/build-n-test-all-distros.yml
    with:
      BUILD_DISTS: ${{ vars.BUILD_DISTS }}
      BUILD_ARCHS: ${{ vars.BUILD_ARCHS }}
      BUILD_EXCLUDE: ${{ vars.BUILD_EXCLUDE }}
      SMOKE_TEST_IMAGES: ${{ vars.SMOKE_TEST_IMAGES }}
      release_tag: >-
        ${{ (github.ref_name == 'unstable'
        || github.event_name == 'workflow_dispatch'
        || github.event_name == 'workflow_call')
        && 'unstable'
        || ''
        }}
      checkout_ref: ${{ github.ref_name == 'unstable' && 'unstable' || '' }}
